# Freelancer Chat

CLI‑утилита, которая за **одну команду**:
1. При необходимости импортирует локальный CSV‑файл с доходами фрилансеров в
   SQLite‑базу.
2. Позволяет задать вопрос ChatGPT, где модель сама делает SQL‑запросы к этой
   базе через встроенную функцию `run_sql_query`.

---
## Особенности

* **Авто‑импорт** — если `database.db` или таблицы ещё нет, CSV (`freelancer_earnings_bd.csv` по умолчанию) подтянется сам.
* **Чистый SQL** — LLM может агрегировать, фильтровать, сортировать данные без лишнего кода.
* **Минимум зависимостей** — один файл `main.py`, два пакета (`openai`, `python-dotenv`).

---
## Установка

```bash
python -m pip install openai python-dotenv
```

Создайте рядом с `main.py` файл `.env` и положите в него ключ OpenAI:

```dotenv
OPENAI_API_KEY=sk-...
```

### Переменные окружения
| Переменная   | Зачем нужна                         | Значение по умолчанию |
|--------------|-------------------------------------|-----------------------|
| `CSV_PATH`   | Путь до CSV для авто‑импорта        | `./freelancer_earnings_bd.csv` |
| `OPENAI_API_KEY` | Ключ OpenAI для чата            | — |

---
## Запуск

### Разовый вопрос
```bash
python main.py chat "средняя почасовая ставка по площадкам"
```

### Интерактивный режим
```bash
python main.py chat          # далее вводите вопросы, exit/quit для выхода
```

---
## Что происходит под капотом
1. Скрипт проверяет наличие базы и таблицы.
2. Если их нет — читает CSV, очищает названия колонок (пробел, точка, дефис → `_`) и создаёт таблицу `freelancer_earnings_bd`.
3. В **system prompt** модель узнаёт схему таблицы и возможность вызвать `run_sql_query`.
4. LLM делает до 5 вызовов функции, формирует ответ и выводит его.
